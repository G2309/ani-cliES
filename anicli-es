#!/usr/bin/env python3

import sys
import urllib.request
import urllib.parse
import ssl
from bs4 import BeautifulSoup

ssl._create_default_https_context = ssl._create_unverified_context

BASE_URL = "https://www3.animeflv.net"

def fetch(url):
    headers = {
        "User-Agent": "Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36"
    }
    req = urllib.request.Request(url, headers=headers)
    with urllib.request.urlopen(req, timeout=30) as resp:
        return resp.read().decode("utf-8")

def search(query):
    url = f"{BASE_URL}/browse?q={urllib.parse.quote(query)}"
    html = fetch(url)
    soup = BeautifulSoup(html, "html.parser")
    
    results = []
    for article in soup.select("article.Anime"):
        link = article.select_one("a")
        title = article.select_one("h3.Title")
        type_span = article.select_one("span.Type")
        
        if link and title:
            results.append({
                "title": title.get_text(strip=True),
                "url": BASE_URL + link.get("href"),
                "type": type_span.get_text(strip=True) if type_span else "?"
            })
    
    return results

if __name__ == "__main__":
    query = sys.argv[1] if len(sys.argv) > 1 else "naruto"
    
    print(f"Buscando: {query}\n")
    
    results = search(query)
    
    for i, r in enumerate(results, 1):
        print(f"[{i}] [{r['type']}] {r['title']}")
        print(f"    {r['url']}\n")
